// This has been compiled for mobile's lack of ES6 features
var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};Handlebars.registerHelper("times",function(a,b){for(var c="",d=0;d<a;++d)c+=b.fn(d);return c});
var teacherGroupTemplate=Handlebars.compile($("#teacher-group-template").html()),questionTemplates={"rating-table":Handlebars.compile($("#question-rating-table").html()),"multi-column-list":Handlebars.compile($("#question-multi-column-list").html()),"large-textbox":Handlebars.compile($("#question-large-textbox").html()),"yes-no":Handlebars.compile($("#question-yes-no").html()),"multi-from-list":Handlebars.compile($("#question-multi-from-list").html()),"radio-list":Handlebars.compile($("#question-radio-list").html())},
questionValidators={"rating-table":function(a){var b=a.find(".rating-table-vote input").length/5;a=a.find(".rating-table-vote input:checked").length;return 0!=b-a&&(alert("Please select a rating for every row."),!0)},"multi-column-list":function(a){return!a.find("ul").map(function(){return 0<$(this).find("li").length}).get().every(function(a){return a})&&(alert("Enter at least one value for each column."),!0)},"large-textbox":function(a){return!(0<a.find("textarea").val().length)&&(alert("Please type something in the text box."),
!0)},"yes-no":function(a){return 1!=a.find("input:checked").length&&(alert("Please select yes or no."),!0)},"multi-from-list":function(a){return!a.find("select").map(function(){return!!$(this).val()}).get().every(function(a){return a})&&(alert("Select an item for each dropdown."),!0)},"radio-list":function(a){return 1!=a.find("input:checked").length&&(alert("Select an option in the poll."),!0)}},questionProcessors={"rating-table":function(a){var b=[];return a.find(".rating-table").find("input:checked").each(function(){var a=
$(this).parents("tr").index(),d=$(this).val();b[a]=d}),b},"multi-column-list":function(a){a=a.find(".multi-column-list");var b=a.find("th").map(function(){return $(this).text()}).get(),c={};return a.find("ul").each(function(){var a=$(this).parents("td").index();a=b[a];var e=$(this).find("li").map(function(){return $(this).text()}).get();c[a]=e}),c},"large-textbox":function(a){return a.find(".large-textbox").val()},"yes-no":function(a){return"1"==a.find("input:checked").val()},"multi-from-list":function(a){return a.find(".multi-from-list-select").map(function(){return $(this).val()}).get()},
"radio-list":function(a){return a.find("input:checked").val()}},numberRegex=/[0-9]/,pin;$("#pin-input").on("keypress",function(a){var b=a.which||a.code;return a.key=a.key||String.fromCharCode(b),numberRegex.test(a.key)&&4!==$("#pin-input").val().length?void(3===$("#pin-input").val().length&&setTimeout(function(){pin=("0000"+parseInt($("#pin-input").val())).substr(-4,4);submitPin(pin);$("#pin-input").prop("disabled",!0).blur()},300)):(a.preventDefault(),void a.stopPropagation())});
function submitPin(a){axios.post("/api/fetch",{pin:a}).then(function(a){return a.data}).then(function(a){if(a.success){var b=a.subjects;return axios.get("/api/questions").then(function(a){return a.data}).then(function(a){return createViews(a,b)})}alert("Invalid pin!");$("#pin-input").prop("disabled",!1).focus().val("")})}var groups;
function createViews(a,b){var c=[];a.forEach(function(a){a.questions.forEach(function(a){for(var b="_"+Math.random().toString(36).substr(2,9);-1!=c.indexOf(b);)b="_"+Math.random().toString(36).substr(2,9);a.data.unique=b})});groups=b.map(function(b,c){var d=a.map(function(a){var b=a.questions.map(function(a){a=JSON.parse(JSON.stringify(a));return a.data.unique+=c,a});return _extends({},a,{questions:b})});return _extends({},b,{sections:d})});var d=[];groups.forEach(function(a,b){a.index=b;a.sections.forEach(function(a){var b=
a.questions.map(function(a){var b=$("<div class='question'>"+questionTemplates[a.type](a.data)+"</div>");return b.attr("data-type",a.type),b.attr("data-id",a.id),b.attr("data-required",a.required),b.prop("outerHTML")});a.html=b.join("")});var c=$(teacherGroupTemplate(a));d.push(c)});$("body").append(d);initEvents();setTimeout(function(){$(".teacher-group:eq(0)").addClass("show")},20)}
function initEvents(){$(".teacher-group-hero-continue").on("click",firstSection);$(".next-button").on("click",nextSection);$(".teacher-group").bind("completed",submitGroup);$(".rating-table-vote label").on("click",function(){$(this).prev().click()});$(".multi-column-list-input").on("keyup",function(a){if(13==(a.which||a.code)&&""!=$(this).val()){a=$(this).parent().index();a=$(this).parents("tbody").find("td:eq("+a+") ul");var b=$("<li>").html($(this).val());b.on("click",function(){$(this).slideUp(function(){$(this).remove()})});
a.append(b);$(this).val("")}});$(".multi-from-list-select").on("change",function(){if($(this).data("no-repeats")){var a=$(this).data("previous"),b=$(this).val();$(this).parent().siblings().find(".multi-from-list-select").each(function(){$(this).find("option").each(function(){$(this).text()==a&&$(this).prop("disabled",!1);$(this).text()==b&&$(this).prop("disabled",!0)})});$(this).data("previous",b)}})}
function checkIfCanProceed(){return!$(this).parents(".teacher-group").find(".section.show").find(".question").toArray().some(function(a){a=$(a);if(!a.data("required"))return!1;var b=a.data("type");return questionValidators[b](a)})}function changeTitle(a,b){var c=a.find(".group-title");c.find(".current-title").text()==b||(c.find(".next-title").text(b),c.addClass("next"),setTimeout(function(){c.removeClass("next").find(".current-title").text(b)},500))}
function firstSection(){var a=$(this).parents(".teacher-group"),b=$(this).parents(".teacher-group-hero"),c=a.find(".section").eq(0);b.addClass("hide");a.find(".current-title").text(c.data("title"));c.addClass("show")}
function nextSection(){var a=$(this).parents(".teacher-group"),b=a.find(".section.show");if(checkIfCanProceed.call(this)&&confirm("Are you sure you want to proceed?")){b.triggerHandler("completed");var c=b.next();return c.length?void(changeTitle(a,c.data("title")),b.toggleClass("show done"),c.addClass("show")):nextGroup()}}
function nextGroup(){var a=$(".teacher-group.show");a.triggerHandler("completed");var b=a.next();return b.length?void(setTimeout(function(){a.removeClass("show")},500),b.addClass("show")):groupsDone()}
function submitGroup(){var a=$(this);a.data("index");var b={};a.find(".question").each(function(){var a=$(this).data("type");a=questionProcessors[a]($(this));var d=$(this).data("id");b[d]=a});axios.post("/api/submit",{subjectId:a.data("subject-id"),selections:b,pin:pin}).then(function(){return console.log("Saved submission.")})}function groupsDone(){$("body").empty()};