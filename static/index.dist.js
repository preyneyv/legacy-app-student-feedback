'use strict';;var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a};Handlebars.registerHelper('times',function(a,b){for(var c='',d=0;d<a;++d)c+=b.fn(d);return c});var teacherGroupTemplate=Handlebars.compile($('#teacher-group-template').html()),questionTemplates={'rating-table':Handlebars.compile($('#question-rating-table').html()),'multi-column-list':Handlebars.compile($('#question-multi-column-list').html()),'large-textbox':Handlebars.compile($('#question-large-textbox').html()),'yes-no':Handlebars.compile($('#question-yes-no').html()),'multi-from-list':Handlebars.compile($('#question-multi-from-list').html()),'radio-list':Handlebars.compile($('#question-radio-list').html())},questionValidators={'rating-table':function ratingTable(a){var b=a.find('.rating-table-vote input').length/5,c=a.find('.rating-table-vote input:checked').length;return 0!=b-c&&(alert('Please select a rating for every row.'),!0)},'multi-column-list':function multiColumnList(a){var b=a.find('ul').map(function(){return 0<$(this).find('li').length}).get();return!b.every(function(c){return c})&&(alert('Enter at least one value for each column.'),!0)},'large-textbox':function largeTextbox(a){var b=a.find('textarea');return!(0<b.val().length)&&(alert('Please type something in the text box.'),!0)},'yes-no':function yesNo(a){return 1!=a.find('input:checked').length&&(alert('Please select yes or no.'),!0)},'multi-from-list':function multiFromList(a){var b=a.find('select').map(function(){return!!$(this).val()}).get();return!b.every(function(c){return c})&&(alert('Select an item for each dropdown.'),!0)},'radio-list':function radioList(a){return 1!=a.find('input:checked').length&&(alert('Select an option in the poll.'),!0)}},questionProcessors={'rating-table':function ratingTable(a){var b=a.find('.rating-table'),c=[];return b.find('input:checked').each(function(){var d=$(this).parents('tr').index(),f=$(this).val();c[d]=f}),c},'multi-column-list':function multiColumnList(a){var b=a.find('.multi-column-list'),c=b.find('th').map(function(){return $(this).text()}).get(),d={};return b.find('ul').each(function(){var f=$(this).parents('td').index(),g=c[f],h=$(this).find('li').map(function(){return $(this).text()}).get();d[g]=h}),d},'large-textbox':function largeTextbox(a){var b=a.find('.large-textbox');return b.val()},'yes-no':function yesNo(a){var b=a.find('input:checked').val();return'1'==b},'multi-from-list':function multiFromList(a){var b=a.find('.multi-from-list-select'),c=b.map(function(){return $(this).val()}).get();return c},'radio-list':function radioList(a){var b=a.find('input:checked').val();return b}},numberRegex=/[0-9]/,pin;$('#pin-input').on('keypress',function(a){var b=a.which||a.code;return a.key=a.key||String.fromCharCode(b),numberRegex.test(a.key)&&4!==$('#pin-input').val().length?void(3===$('#pin-input').val().length&&setTimeout(function(){pin=('0000'+parseInt($('#pin-input').val())).substr(-4,4),submitPin(pin),$('#pin-input').prop('disabled',!0).blur()},300)):(a.preventDefault(),void a.stopPropagation())});function submitPin(a){axios.post('/api/fetch',{pin:a}).then(function(b){return b.data}).then(function(b){if(b.success){var c=b.subjects;return axios.get('/api/questions').then(function(d){return d.data}).then(function(d){return createViews(d,c)})}alert('Invalid pin!'),$('#pin-input').prop('disabled',!1).focus().val('')})}var groups;function createViews(a,b){var d=[];a.forEach(function(f){f.questions.forEach(function(g){for(var h='_'+Math.random().toString(36).substr(2,9);-1!=d.indexOf(h);)h='_'+Math.random().toString(36).substr(2,9);g.data.unique=h})}),groups=b.map(function(f,g){var h=a.map(function(j){var k=j.questions.map(function(l){var m=JSON.parse(JSON.stringify(l));return m.data.unique+=g,m});return _extends({},j,{questions:k})});return _extends({},f,{sections:h})});var c=[];groups.forEach(function(f,g){f.index=g,f.sections.forEach(function(j){var k=j.questions.map(function(l){var m=$('<div class=\'question\'>'+questionTemplates[l.type](l.data)+'</div>');return m.attr('data-type',l.type),m.attr('data-id',l.id),m.attr('data-required',l.required),m.prop('outerHTML')});j.html=k.join('')});var h=$(teacherGroupTemplate(f));c.push(h)}),$('body').append(c),initEvents(),setTimeout(function(){$('.teacher-group:eq(0)').addClass('show')},20)}function initEvents(){$('.teacher-group-hero-continue').on('click',firstSection),$('.next-button').on('click',nextSection),$('.teacher-group').bind('completed',submitGroup),$('.rating-table-vote label').on('click',function(){$(this).prev().click()}),$('.multi-column-list-input').on('keyup',function(a){var b=a.which||a.code;if(13==b){if(''==$(this).val())return;var c=$(this).parent().index(),d=$(this).parents('tbody').find('td:eq('+c+') ul'),f=$('<li>').html($(this).val());f.on('click',function(){$(this).slideUp(function(){$(this).remove()})}),d.append(f),$(this).val('')}}),$('.multi-from-list-select').on('change',function(){if($(this).data('no-repeats')){var b=$(this).data('previous'),c=$(this).val(),d=$(this).parent().siblings().find('.multi-from-list-select');d.each(function(){$(this).find('option').each(function(){$(this).text()==b&&$(this).prop('disabled',!1),$(this).text()==c&&$(this).prop('disabled',!0)})}),$(this).data('previous',c)}})}function checkIfCanProceed(){var a=$(this).parents('.teacher-group'),b=a.find('.section.show'),c=!b.find('.question').toArray().some(function(d){var f=$(d);if(!f.data('required'))return!1;var g=f.data('type');return questionValidators[g](f)});return c}function changeTitle(a,b){var c=a.find('.group-title');c.find('.current-title').text()==b||(c.find('.next-title').text(b),c.addClass('next'),setTimeout(function(){c.removeClass('next').find('.current-title').text(b)},500))}function firstSection(){var a=$(this).parents('.teacher-group'),b=$(this).parents('.teacher-group-hero'),c=a.find('.section').eq(0);b.addClass('hide'),a.find('.current-title').text(c.data('title')),c.addClass('show')}function nextSection(){var a=$(this).parents('.teacher-group'),b=a.find('.section.show');if(checkIfCanProceed.call(this)&&confirm('Are you sure you want to proceed?')){b.triggerHandler('completed');var c=b.next();return c.length?void(changeTitle(a,c.data('title')),b.toggleClass('show done'),c.addClass('show')):nextGroup()}}function nextGroup(){var a=$('.teacher-group.show');a.triggerHandler('completed');var b=a.next();return b.length?void(setTimeout(function(){a.removeClass('show')},500),b.addClass('show')):groupsDone()}function submitGroup(){var a=$(this),b=a.data('index'),c={};a.find('.question').each(function(){console.log('Looping');var d=$(this).data('type');console.log(d);var f=questionProcessors[d]($(this));console.log(f);var g=$(this).data('id');c[g]=f}),axios.post('/api/submit',{subjectId:a.data('subject-id'),selections:c,pin:pin}).then(function(){return console.log('Saved submission.')})}function groupsDone(){$('body').empty(),alert('Thank you for participating! Your submissions have been saved.')}